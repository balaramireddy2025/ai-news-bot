<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"></script>

<script>
    // Firebase Configuration - COMPLETE AND CORRECT
    const firebaseConfig = {
        apiKey: "AIzaSyBEOVKrdLE7G3TnxWtCjnYIqRNcO4vXQPM",
        authDomain: "ai-news-a0483.firebaseapp.com",
        projectId: "ai-news-a0483",
        storageBucket: "ai-news-a0483.firebasestorage.app",
        messagingSenderId: "227037934522",
        appId: "1:227037934522:web:af54212806891a09e46383",
        databaseURL: "https://ai-news-a0483-default-rtdb.firebaseio.com"
    };

    let allNews = [];
    let currentFilter = 'all';

    // Initialize Firebase
    try {
        firebase.initializeApp(firebaseConfig);
        console.log('‚úÖ Firebase initialized successfully!');
    } catch (error) {
        console.error('‚ùå Firebase initialization error:', error);
    }

    const db = firebase.database();

    // Load news from Firebase
    function loadNews() {
        console.log('üîÑ Attempting to load news from Firebase...');

        try {
            const newsRef = db.ref('news');

            newsRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    allNews = snapshot.val();
                    console.log('‚úÖ Successfully loaded', allNews.length, 'articles from Firebase');

                    // Update last updated time
                    if (allNews && allNews.length > 0 && allNews[0].fetchedAt) {
                        const lastFetch = new Date(allNews[0].fetchedAt);
                        document.getElementById('lastUpdated').innerHTML =
                            `‚úÖ Last updated: ${lastFetch.toLocaleString()}`;
                    }

                    renderNews();
                } else {
                    console.warn('‚ö†Ô∏è No data in Firebase. Run your bot first!');
                    showError('‚ö†Ô∏è No news data yet. Run your Python bot: python main.py');
                    showWaitingMessage();
                }
            }, (error) => {
                console.error('‚ùå Firebase read error:', error.code, error.message);
                showError('Firebase Error: ' + error.message);
                showWaitingMessage();
            });
        } catch (error) {
            console.error('‚ùå Error setting up Firebase listener:', error);
            showError('Setup Error: ' + error.message);
        }
    }

    function renderNews() {
        const newsGrid = document.getElementById('newsGrid');
        newsGrid.innerHTML = '';

        const filtered = currentFilter === 'all'
            ? allNews
            : allNews.filter(n => n.category === currentFilter);

        if (filtered.length === 0) {
            newsGrid.innerHTML = '<div class="loading">No news in this category</div>';
            return;
        }

        filtered.forEach((news, index) => {
            const newsCard = document.createElement('div');
            newsCard.className = 'news-card';
            newsCard.style.animationDelay = (index * 0.1) + 's';
            newsCard.innerHTML = `
                <div class="card-image ${news.category || 'ai'}">
                    <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                        <span>${news.emoji || 'üì∞'}</span>
                        ${news.category === 'breaking' ? '<div class="breaking-badge">üî¥ BREAKING</div>' : ''}
                    </div>
                </div>
                <div class="card-content">
                    <span class="card-category ${news.category || 'ai'}">${(news.category || 'news').toUpperCase()}</span>
                    <h3 class="card-title">${news.title}</h3>
                    <p class="card-description">${news.description || 'No description available'}</p>
                    <div class="card-meta">
                        <div class="card-date">üìÖ ${news.date || 'Unknown'}</div>
                        <a class="read-more" href="${news.url || '#'}" target="_blank">Read More ‚Üí</a>
                    </div>
                </div>
            `;
            newsGrid.appendChild(newsCard);
        });
    }

    function filterNews(category) {
        currentFilter = category;

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        renderNews();
    }

    function showError(message) {
        const errorContainer = document.getElementById('errorContainer');
        errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
    }

    function showWaitingMessage() {
        const newsGrid = document.getElementById('newsGrid');
        newsGrid.innerHTML = `
            <div class="demo-news" style="grid-column: 1 / -1; text-align: center;">
                <h3>‚è≥ Waiting for news data...</h3>
                <p><strong>Step 1:</strong> Run your Python bot:</p>
                <p><code style="background: #333; padding: 10px; display: block; margin: 10px 0; border-radius: 5px;">python main.py</code></p>
                <p><strong>Step 2:</strong> Wait for bot to fetch news</p>
                <p><strong>Step 3:</strong> Refresh this page</p>
                <p style="margin-top: 20px; color: #ccc;">Bot output should show: ‚úÖ Updated Firebase with X articles</p>
            </div>
        `;
    }

    // Load news on page load
    console.log('üöÄ AI Comic News Website initialized');
    loadNews();

    // Refresh every 5 minutes
    setInterval(loadNews, 5 * 60 * 1000);
</script>
